# Stock Screener PRD (Product Requirements Document)

> 최종 업데이트: 2026-01-04

## 1. 제품 비전

### 핵심 가치

> **가치투자를 할만한 종목을 찾고 어떤 액션을 지금 해야하는지 인사이트 제공**

| 핵심 가치 | 설명 |
|-----------|------|
| **종목 추천** | 가치 투자 조건에 부합하는 종목을 자동으로 발굴하여 추천 |
| **매수 분석** | 지표, 뉴스, 퀀트 분석을 통해 언제, 얼마에 매수할지 가이드 제공 |
| **매도 분석** | 보유 종목에 대해 목표가, 손절가 기반 매도 시점 분석 리포트 제공 |

### 최종 목표

채팅 기반 AI Agent가 가치투자를 제안하고 컨설팅하는 **개인 투자 어드바이저**

### 사용자 경험 목표

```
사용자: "AAPL 지금 살만해?"
AI Agent: "AAPL 현재 P/E 28.5로 역사적 평균(25) 대비 고평가 상태입니다.
          하지만 ROE 147%, Net Margin 25%로 수익성은 매우 우수합니다.
          Graham Number 대비 20% 고평가이며, RSI 45로 중립 구간입니다.
          배당 수익률 0.5%로 배당 투자자에게는 매력이 낮습니다.

          💡 제안: 현재가보다 10% 하락 시 매수 고려"
```

### 타겟 사용자

- 가치투자에 관심 있는 개인 투자자
- 미국/한국 주식 시장에 투자하는 사용자
- 지표 기반 의사결정을 원하는 사용자

---

## 2. 설계 원칙

### 2.1 인사이트 우선 (Insight First)

- 데이터 나열 < 의미 있는 해석
- "이 종목 살만해?"에 명확한 답변
- 복잡한 지표를 단순한 신호로 변환

### 2.2 액션 지향 (Action-Oriented)

- 모든 분석에는 다음 행동 제안 포함
- 매수/관망/회피 등 명확한 가이드
- 조건부 액션 제시 ("X% 하락 시 매수 고려")

### 2.3 리스크 명시 (Risk Visibility)

- 위험 요소는 항상 눈에 띄게 표시
- 재무 건전성 경고 필수 표시
- 면책 조항 적절히 배치

### 2.4 컨텍스트 제공 (Context Matters)

- 절대 수치보다 상대적 위치 강조
- 섹터/시장 평균 대비 비교
- Graham Number 대비 저/고평가 %

### 2.5 AI Agent 역할

AI Agent는 **'투자 의사결정 파트너'**로서 시스템이 생성한 분석 결과를 사용자가 이해하고 신뢰할 수 있도록 맥락을 설명합니다.

| 핵심 가치 | 시스템 역할 | Agent 역할 |
|-----------|-------------|------------|
| 종목 추천 | 스크리닝 로직으로 후보군 제시 | "왜 이 종목인지" 맥락 설명 |
| 매수 분석 | 지표/뉴스 기반 퀀트 리포트 | "지금 사도 돼?" 종합 판단 |
| 매도 분석 | 목표가/손절가 리포트 생성 | "왜 이 가격인지" 근거 설명 |

---

## 3. 핵심 기능

### 3.1 스크리닝 (Phase 2) - 완료

| 기능 | 설명 | 상태 |
|------|------|------|
| 프리셋 필터 | Graham, Buffett, Dividend 등 | ✅ |
| 커스텀 필터 | 20개 지표 기반 필터링 | ✅ |
| 정렬/페이지네이션 | 결과 탐색 | ✅ |

### 3.2 워치리스트/알림 (Phase 3) - 완료

| 기능 | 설명 | 상태 |
|------|------|------|
| 워치리스트 | 관심 종목 저장 | ✅ |
| 알림 | 지표 조건 기반 알림 | ✅ |
| 디스코드 봇 | 봇으로 조회/관리 | ✅ |

### 3.3 투자 인사이트 (Phase 3.5) - 완료

| 기능 | 설명 | 상태 |
|------|------|------|
| 투자 신호 | 종합 점수 + 매수/관망/회피 | ✅ |
| 액션 가이드 | 구체적 행동 제안 | ✅ |
| 리스크 경고 | 재무 위험 명시 | ✅ |

### 3.4 AI 분석 (Phase 4) - 예정

| 기능 | 설명 | 상태 |
|------|------|------|
| AI 종합 분석 | Claude + 웹검색 기반 분석 | 예정 |
| 뉴스 반영 | 최근 이슈 수집 | 예정 |
| OpenSearch 저장 | 분석 결과 캐싱 | 예정 |

### 3.5 AI 어드바이저 (Phase 5) - 예정

| 기능 | 설명 | 상태 |
|------|------|------|
| 오늘의 추천 | 저평가 종목 자동 추천 | 예정 |
| 개인화 추천 | 워치리스트 기반 유사 종목 | 예정 |
| 채팅 UI | 자연어 질의 응답 | 예정 |

### 3.6 운영/인프라 (Phase 외)

| 기능 | 설명 | 상태 |
|------|------|------|
| 전체 미국 시장 수집 | NYSE + NASDAQ 전체 (~6,000개) | ✅ 완료 |
| 티커 요청 | 미수집 종목 GitHub Issue로 요청 | 예정 |
| 디스코드 봇 24/7 배포 | 상시 운영 | 예정 |
| i18n | 한/영 다국어 | 예정 |
| 커스텀 도메인 | 도메인 연결 | 예정 |
| 프리셋 고급 기능 | 수정/공유/복제 | 예정 |

> **티커 확장 전략**: `.claude/rules/ticker-strategy.md` 참조

---

## 4. 스크리닝 조건

### 4.1 정적 조건 (가치 투자)

매일 배치로 실행되어 가치 투자 기준에 부합하는 종목을 발굴합니다.

#### 그레이엄 스타일 (안전마진)

- PER < 15
- PBR < 1.5
- 부채비율 < 50%
- 유동비율 > 1.5

#### 배당 가치주

- 배당수익률 > 3%
- 배당성향 < 70%
- 연속 배당 연수 > 5년 *(데이터 수집 필요)*

#### 퀄리티 가치주 (버핏 스타일)

- ROE > 15%
- PER < 20
- 부채비율 < 40%
- 3년 이익 성장률 > 0 *(데이터 수집 필요)*

#### 딥밸류 (역발상)

- PBR < 0.7
- PER < 10
- 시가총액 > 1,000억원

### 4.2 동적 조건 (최근 시그널)

최근 움직임이 있는 종목을 포착하여 타이밍을 잡습니다.

#### 모멘텀 시그널

- 52주 신고가 근접 (90% 이상) ✅ 현재 데이터로 구현 가능
- 골든크로스 발생 (MA50 > MA200) ✅ 현재 데이터로 구현 가능
- 최근 5일 평균 거래량 > 20일 평균 × 2 *(추가 데이터 수집 필요)*

#### 실적 서프라이즈

- 최근 분기 실적 컨센서스 10% 이상 상회 *(외부 API 필요)*
- 2분기 연속 어닝 서프라이즈 *(외부 API 필요)*
- 애널리스트 목표가 상향 조정 *(외부 API 필요)*

#### 수급 시그널

- 외국인 5일 연속 순매수 *(KRX 데이터 필요)*
- 기관 순매수 전환 *(KRX 데이터 필요)*
- 공매도 잔고 감소 *(외부 API 필요)*

#### 턴어라운드

- 적자 → 흑자 전환 *(분기 데이터 필요)*
- 영업이익률 전분기 대비 개선 *(분기 데이터 필요)*
- 부채비율 감소 추세

#### 뉴스 센티먼트

- 최근 7일 뉴스 센티먼트 급상승 *(Phase 5에서 구현)*
- 긍정 뉴스 비율 70% 이상 *(Phase 5에서 구현)*

### 4.3 조합 조건 (가치 + 촉매)

저평가 종목 중 최근 움직임이 시작된 종목을 포착합니다.
- 가치 조건 충족 + 동적 시그널 1개 이상 충족 시 선정

### 4.4 예상 종목 수

| 카테고리 | 예상 종목 수 |
|----------|-------------|
| 정적 조건 (가치 투자) | 100~150개 |
| 동적 시그널 | 50~100개 |
| **중복 제거 후 총합** | **150~200개** |

---

## 5. 보고서 구조 (OpenSearch)

스크리닝된 종목에 대해 일별 보고서를 생성하여 **OpenSearch에 저장**합니다.

### 5.1 OpenSearch 활용 이점

| 기능 | Agent 활용 |
|------|-----------|
| **전문 검색** | "HBM 관련 종목 찾아줘" → 보고서 전체에서 키워드 검색 |
| **벡터 검색** | "삼성전자랑 비슷한 종목" → 임베딩 기반 유사 종목 검색 |
| **필터 + 집계** | "PER 10 이하면서 배당률 높은 종목" → 복합 조건 필터 |
| **실시간 검색** | 보고서 저장 즉시 검색 가능 |

### 5.2 인덱스 스키마

#### 기본 정보
- `ticker`: 종목 코드 (예: 005930.KS)
- `name`: 종목명
- `date`: 보고서 생성일
- `sector`: 업종
- `market_cap`: 시가총액

#### 밸류에이션 (valuation)
- `fair_value`: 적정가
- `current_price`: 현재가 (당일 종가)
- `upside`: 괴리율 (%)
- `method`: 산출 방법 (예: DCF + PER 혼합)

#### 핵심 지표 (metrics)
- `per`, `pbr`, `roe`, `dividend_yield`, `debt_ratio`

#### 투자 의견 (opinion)
- `signal`: BUY / HOLD / SELL
- `confidence`: 신뢰도 (0~1)
- `summary`: 한 줄 요약

#### 매매 기준 (trading)
- `buy_price`: 매수 적정가
- `target_price`: 목표가
- `stop_loss`: 손절가

#### 리스크 (risks)
- 리스크 요인 목록 (배열)

#### 뉴스/동향 (news)
- `sentiment_score`: 센티먼트 점수 (-1 ~ 1)
- `sentiment_label`: positive / neutral / negative
- `trend`: improving / stable / deteriorating
- `highlights`: 주요 뉴스 목록 (title, date, sentiment)
- `sector_trend`: 업종 동향 요약

#### 추가 정보
- `screening_tags`: 해당 종목이 충족한 스크리닝 조건 태그
- `recommendation_reason`: 추천 사유 (추천 종목만)
- `embedding`: 시맨틱 검색용 벡터

### 5.3 인덱스 예시

```json
{
  "ticker": "005930.KS",
  "name": "삼성전자",
  "date": "2026-01-03",
  "sector": "반도체",
  "market_cap": 350000000000000,

  "valuation": {
    "fair_value": 72000,
    "current_price": 74500,
    "upside": -3.4,
    "method": "DCF + PER 혼합"
  },

  "metrics": {
    "per": 12.3,
    "pbr": 1.1,
    "roe": 9.2,
    "dividend_yield": 2.1,
    "debt_ratio": 28
  },

  "opinion": {
    "signal": "HOLD",
    "confidence": 0.72,
    "summary": "실적 개선 기대되나 상승여력 제한적"
  },

  "trading": {
    "buy_price": 70000,
    "target_price": 85000,
    "stop_loss": 65000
  },

  "risks": ["중국 수출 규제 리스크", "메모리 가격 하락 가능성"],

  "news": {
    "sentiment_score": 0.65,
    "sentiment_label": "positive",
    "trend": "improving",
    "highlights": [
      {
        "title": "삼성전자, HBM 공급 계약 체결",
        "date": "2026-01-02",
        "sentiment": "positive"
      }
    ],
    "sector_trend": "반도체 업종 수요 회복 기대"
  },

  "screening_tags": ["quality_value", "momentum"],
  "recommendation_reason": "PBR 역사적 저점, HBM 수요 수혜 예상",

  "embedding": [0.123, 0.456, 0.789]
}
```

---

## 6. 투자 신호 기준

### 6.1 점수 계산 (0-100)

기본 점수 50에서 시작, 각 지표별 가감

| 지표 | 조건 | 점수 |
|------|------|------|
| P/E | < 15 | +15 |
| P/E | 15-25 | +5 |
| P/E | > 25 | -10 |
| P/B | < 1 | +15 |
| P/B | 1-1.5 | +5 |
| P/B | > 3 | -10 |
| ROE | > 20% | +15 |
| ROE | 10-20% | +10 |
| ROE | < 5% | -10 |
| D/E | < 0.5 | +10 |
| D/E | > 2 | -15 |
| RSI | < 30 | +10 |
| RSI | > 70 | -10 |
| Graham | 현재가 < Graham Number | +15 |
| MA Trend | Bullish (MA50 > MA200) | +5 |
| MACD | Histogram > 0 | +5 |

### 6.2 신호 매핑

| 점수 | 신호 | 표시 |
|------|------|------|
| 70+ | STRONG_BUY | 강력 매수 |
| 55-69 | BUY | 매수 고려 |
| 40-54 | HOLD | 관망 |
| 25-39 | SELL | 매도 고려 |
| 0-24 | STRONG_SELL | 회피 |

### 6.3 리스크 경고

| 조건 | 레벨 | 메시지 |
|------|------|--------|
| D/E > 2 | HIGH | 높은 부채 비율 - 재무 위험 |
| Current Ratio < 1 | HIGH | 유동성 위험 - 단기 채무 상환 능력 부족 |
| Beta > 1.5 | MEDIUM | 높은 변동성 - 시장 대비 변동폭 큼 |
| RSI > 80 | MEDIUM | 과매수 상태 - 조정 가능성 |
| Net Margin < 0 | HIGH | 순손실 기업 |

---

## 7. UX 요구사항

### 7.1 종목 상세 페이지 레이아웃

```
┌─────────────────────────────────────┐
│ 헤더 (티커, 이름, 마켓 배지)         │
├─────────────────────────────────────┤
│ 🚨 Risk Alerts (해당 시)            │ ← 위험 시 최상단
├─────────────────────────────────────┤
│ ⭐ Investment Signal                │
│ BUY (65/100)                        │
│ 저평가 + 우수한 수익성              │
├─────────────────────────────────────┤
│ 📋 Action Guide                     │
│ • Graham 대비 17% 저평가            │
│ • 52주 저점 근접 시 추가 매수 기회  │
├─────────────────────────────────────┤
│ 가격 정보                           │
├─────────────────────────────────────┤
│ Key Metrics (기존 지표)             │
├─────────────────────────────────────┤
│ ⚠️ 면책 조항                        │
└─────────────────────────────────────┘
```

### 7.2 워치리스트 페이지

- 종목별 신호 요약 (BUY/HOLD/SELL 배지)
- 핵심 지표 하이라이트 (P/E, ROE, RSI)
- 상세 페이지 링크

### 7.3 비워치리스트 종목

- "워치리스트에 추가하면 상세 분석 제공" 안내
- 워치리스트 추가 버튼 노출

---

## 8. 기술 아키텍처

### 8.1 Phase 3.5 (규칙 기반)

```
[프론트엔드]
    │ scoring.ts (점수 계산)
    │ risks.ts (리스크 감지)
    ↓
[InvestmentSignal] [ActionGuide] [RiskAlert]
    │
    ↓
[종목 상세 페이지]
```

### 8.2 Phase 4 (AI 분석 - 배치)

```
[데이터 수집 완료]
    │
    ↓
[Claude Code CLI] ← Max 구독 활용 (API 비용 $0)
    │ - 웹검색 (뉴스, 이슈)
    │ - 지표 분석
    │ - 인사이트 생성
    ↓
[OpenSearch] ← 직접 호스팅
    │ - 티커별 분석 문서 저장
    │ - 변경분만 업데이트
    ↓
[Stock-Screener API]
    │ - OpenSearch 조회만
    ↓
[프론트엔드]
```

#### 구현 단계

| 단계 | 작업 | 기술 |
|------|------|------|
| 4.1 | OpenSearch 인프라 | AWS OpenSearch Serverless / 직접 호스팅 |
| 4.2 | 분석 스크립트 | Claude Code CLI + 웹검색 |
| 4.3 | 분석 결과 저장 | OpenSearch 인덱스 |
| 4.4 | 조회 API | FastAPI + OpenSearch 클라이언트 |

#### 분석 내용

- 종목 기본 정보 + 재무 지표 요약
- 웹검색 기반 최근 뉴스/이슈
- 투자 인사이트 (매수/관망/회피 근거)
- 리스크 요인

### 8.3 Phase 5 (AI 어드바이저 - 실시간)

```
[사용자 질의]
    ↓
[LangGraph Agent] ← 실시간 채팅용
    │ - 의도 분류 (종목 분석 / 스크리닝 / 추천 / 일반)
    │ - Tool 호출
    ↓
[OpenSearch 검색] → 저장된 분석 조회
    ↓
[컨텍스트 구성] → 관련 종목 + 지표 + 뉴스
    ↓
[LLM 응답 생성]
    ↓
[웹 채팅 UI]
```

#### AI Agent Tools

| Tool | 설명 |
|------|------|
| `get_recommendations(market, category)` | 시장(US/KR), 카테고리별 추천 종목 리스트 조회 |
| `get_report(ticker)` | 특정 종목의 상세 보고서 조회 |
| `search_reports(query)` | OpenSearch 기반 보고서 검색 (키워드/시맨틱) |
| `search_news(ticker)` | 실시간 뉴스 검색 (보고서 이후 최신 뉴스) |
| `get_watchlist(user_id)` | 사용자 관심/보유 종목 조회 |
| `compare_stocks(tickers[])` | 여러 종목 비교 분석 |

#### 사용 시나리오

**시나리오 1: 추천 종목 이해**
> **User:** "오늘 추천된 종목 중에 왜 HD현대가 들어갔어?"
>
> **Agent:** HD현대가 추천된 이유는 PBR 0.6으로 업종 평균 대비 40% 할인, 최근 3분기 연속 영업이익 증가, 조선 업황 사이클 상승 구간 진입 등입니다. 다만 리스크로는 환율 변동성이 있습니다.

**시나리오 2: 매수 타이밍 판단**
> **User:** "삼성전자 지금 사도 돼?"
>
> **Agent:** 현재 분석 기준으로 적정 매수가는 72,000원 (현재가 74,500원), 기술적 지지선은 71,000원입니다. 2.5% 정도 더 빠지면 매수 적기로 보입니다. 분할 매수 계획을 세워드릴까요?

**시나리오 3: 보유 종목 관리**
> **User:** "내 보유 종목 중에 지금 팔아야 할 거 있어?"
>
> **Agent:** 3개 종목을 점검했습니다. 카카오는 목표가 55,000원 도달로 일부 익절을 고려하세요. NAVER와 셀트리온은 목표가까지 여유가 있어 보유 유지를 권장합니다.

**시나리오 4: 시맨틱 검색**
> **User:** "HBM 관련주 중에 저평가된 종목 있어?"
>
> **Agent:** OpenSearch에서 HBM 키워드로 검색한 결과, SK하이닉스와 한미반도체가 있습니다. 한미반도체는 PER 8.2로 업종 평균 대비 저평가 상태이고, 최근 외국인 순매수도 유입 중입니다.

#### 기능

| 기능 | 설명 |
|------|------|
| 오늘의 추천 | 저평가 종목 자동 추천 |
| 개인화 추천 | 워치리스트 기반 유사 종목 |
| 채팅 UI | 자연어 질의 응답 |
| 시장 동향 | 일일 시장 요약 |

### 8.4 기술 스택

| 영역 | 기술 |
|------|------|
| Frontend | Next.js 14, TailwindCSS |
| Backend | FastAPI, Python 3.11+ |
| Database | Supabase (PostgreSQL) |
| 보고서 저장소 | OpenSearch (검색 + 벡터 검색) |
| AI (배치 분석) | Claude Code CLI |
| AI (실시간 채팅) | LangGraph |
| 알림 | Discord Bot |

### 8.5 고려사항

#### 비용 전략

- **Phase 4**: Claude Code CLI (Max 구독) → **$0**
- **OpenSearch**: 직접 호스팅 또는 AWS Serverless
- **Phase 5**: LangGraph + Claude API (채팅량에 따라 과금)

#### 분석 대상 범위 (의사결정 필요)

| 옵션 | 종목 수 | 특징 |
|------|---------|------|
| 전체 | ~9,000개 | 시간/리소스 많이 소요 |
| 워치리스트만 | 가변 | 개인화되지만 제한적 |
| 시가총액 Top N | N개 | 균형잡힌 접근 |

---

## 9. 성공 지표

### 9.1 사용자 가치

- 사용자가 "이 종목 살만해?"에 대한 답을 얻을 수 있는가?
- 명확한 액션 가이드를 제공하는가?
- 리스크를 충분히 인지시키는가?

### 9.2 기능 완성도

- [ ] 투자 신호가 정확한가? (백테스트 검증 - 향후)
- [ ] 리스크 경고가 누락 없이 표시되는가?
- [ ] AI 분석이 가치 있는 인사이트를 제공하는가?

---

## 10. 면책 조항

```
본 정보는 투자 참고용이며 투자 조언이 아닙니다.
AI 분석은 참고 자료로만 활용하시고, 투자 결정은 본인의 판단과 책임 하에 이루어져야 합니다.
```

---

## 관련 문서

- [ROADMAP.md](../ROADMAP.md) - 전체 로드맵
- [architecture.md](../.claude/rules/architecture.md) - 기술 아키텍처
